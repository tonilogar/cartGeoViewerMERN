{"ast":null,"code":"'use strict';\n\nvar Typeahead = require('suggestions');\n\nvar debounce = require('lodash.debounce');\n\nvar extend = require('xtend');\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar exceptions = require('./exceptions');\n\nvar MapboxClient = require('@mapbox/mapbox-sdk');\n\nvar mbxGeocoder = require('@mapbox/mapbox-sdk/services/geocoding');\n\nvar MapboxEventManager = require('./events');\n\nvar localization = require('./localization');\n\nvar subtag = require('subtag');\n\nconst GEOCODE_REQUEST_TYPE = {\n  FORWARD: 0,\n  LOCAL: 1,\n  REVERSE: 2\n};\n/**\n * A geocoder component using the [Mapbox Geocoding API](https://docs.mapbox.com/api/search/#geocoding)\n * @class MapboxGeocoder\n * @param {Object} options\n * @param {String} options.accessToken Required.\n * @param {String} [options.origin=https://api.mapbox.com] Use to set a custom API origin.\n * @param {Object} [options.mapboxgl] A [mapbox-gl](https://github.com/mapbox/mapbox-gl-js) instance to use when creating [Markers](https://docs.mapbox.com/mapbox-gl-js/api/#marker). Required if `options.marker` is `true`.\n * @param {Number} [options.zoom=16] On geocoded result what zoom level should the map animate to when a `bbox` isn't found in the response. If a `bbox` is found the map will fit to the `bbox`.\n * @param {Boolean|Object} [options.flyTo=true] If `false`, animating the map to a selected result is disabled. If `true`, animating the map will use the default animation parameters. If an object, it will be passed as `options` to the map [`flyTo`](https://docs.mapbox.com/mapbox-gl-js/api/#map#flyto) or [`fitBounds`](https://docs.mapbox.com/mapbox-gl-js/api/#map#fitbounds) method providing control over the animation of the transition.\n * @param {String} [options.placeholder=Search] Override the default placeholder attribute value.\n * @param {Object} [options.proximity] a proximity argument: this is\n * a geographical point given as an object with `latitude` and `longitude`\n * properties. Search results closer to this point will be given\n * higher priority.\n * @param {Boolean} [options.trackProximity=true] If `true`, the geocoder proximity will automatically update based on the map view.\n * @param {Boolean} [options.collapsed=false] If `true`, the geocoder control will collapse until hovered or in focus.\n * @param {Boolean} [options.clearAndBlurOnEsc=false] If `true`, the geocoder control will clear it's contents and blur when user presses the escape key.\n * @param {Boolean} [options.clearOnBlur=false] If `true`, the geocoder control will clear its value when the input blurs.\n * @param {Array} [options.bbox] a bounding box argument: this is\n * a bounding box given as an array in the format `[minX, minY, maxX, maxY]`.\n * Search results will be limited to the bounding box.\n * @param {string} [options.countries] a comma separated list of country codes to\n * limit results to specified country or countries.\n * @param {string} [options.types] a comma seperated list of types that filter\n * results to match those specified. See https://docs.mapbox.com/api/search/#data-types\n * for available types.\n * If reverseGeocode is enabled and no type is specified, the type defaults to POIs. Otherwise, if you configure more than one type, the first type will be used.\n * @param {Number} [options.minLength=2] Minimum number of characters to enter before results are shown.\n * @param {Number} [options.limit=5] Maximum number of results to show.\n * @param {string} [options.language] Specify the language to use for response text and query result weighting. Options are IETF language tags comprised of a mandatory ISO 639-1 language code and optionally one or more IETF subtags for country or script. More than one value can also be specified, separated by commas. Defaults to the browser's language settings.\n * @param {Function} [options.filter] A function which accepts a Feature in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format to filter out results from the Geocoding API response before they are included in the suggestions list. Return `true` to keep the item, `false` otherwise.\n * @param {Function} [options.localGeocoder] A function accepting the query string which performs local geocoding to supplement results from the Mapbox Geocoding API. Expected to return an Array of GeoJSON Features in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format.\n * @param {Function} [options.externalGeocoder] A function accepting the query string and current features list which performs geocoding to supplement results from the Mapbox Geocoding API. Expected to return a Promise which resolves to an Array of GeoJSON Features in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format.\n * @param {distance|score} [options.reverseMode=distance] - Set the factors that are used to sort nearby results.\n * @param {boolean} [options.reverseGeocode=false] If `true`, enable reverse geocoding mode. In reverse geocoding, search input is expected to be coordinates in the form `lat, lon`, with suggestions being the reverse geocodes.\n * @param {Boolean} [options.enableEventLogging=true] Allow Mapbox to collect anonymous usage statistics from the plugin.\n * @param {Boolean|Object} [options.marker=true]  If `true`, a [Marker](https://docs.mapbox.com/mapbox-gl-js/api/#marker) will be added to the map at the location of the user-selected result using a default set of Marker options.  If the value is an object, the marker will be constructed using these options. If `false`, no marker will be added to the map. Requires that `options.mapboxgl` also be set.\n * @param {Function} [options.render] A function that specifies how the results should be rendered in the dropdown menu. This function should accepts a single [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) object as input and return a string. Any HTML in the returned string will be rendered.\n * @param {Function} [options.getItemValue] A function that specifies how the selected result should be rendered in the search bar. This function should accept a single [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) object as input and return a string. HTML tags in the output string will not be rendered. Defaults to `(item) => item.place_name`.\n * @param {String} [options.mode=mapbox.places] A string specifying the geocoding [endpoint](https://docs.mapbox.com/api/search/#endpoints) to query. Options are `mapbox.places` and `mapbox.places-permanent`. The `mapbox.places-permanent` mode requires an enterprise license for permanent geocodes.\n * @param {Boolean} [options.localGeocoderOnly=false] If `true`, indicates that the `localGeocoder` results should be the only ones returned to the user. If `false`, indicates that the `localGeocoder` results should be combined with those from the Mapbox API with the `localGeocoder` results ranked higher.\n * @example\n * var geocoder = new MapboxGeocoder({ accessToken: mapboxgl.accessToken });\n * map.addControl(geocoder);\n * @return {MapboxGeocoder} `this`\n *\n */\n\nfunction MapboxGeocoder(options) {\n  this._eventEmitter = new EventEmitter();\n  this.options = extend({}, this.options, options);\n  this.inputString = '';\n  this.fresh = true;\n  this.lastSelected = null;\n}\n\nMapboxGeocoder.prototype = {\n  options: {\n    zoom: 16,\n    flyTo: true,\n    trackProximity: true,\n    minLength: 2,\n    reverseGeocode: false,\n    limit: 5,\n    origin: 'https://api.mapbox.com',\n    enableEventLogging: true,\n    marker: true,\n    mapboxgl: null,\n    collapsed: false,\n    clearAndBlurOnEsc: false,\n    clearOnBlur: false,\n    getItemValue: function (item) {\n      return item.place_name;\n    },\n    render: function (item) {\n      var placeName = item.place_name.split(',');\n      return '<div class=\"mapboxgl-ctrl-geocoder--suggestion\"><div class=\"mapboxgl-ctrl-geocoder--suggestion-title\">' + placeName[0] + '</div><div class=\"mapboxgl-ctrl-geocoder--suggestion-address\">' + placeName.splice(1, placeName.length).join(',') + '</div></div>';\n    }\n  },\n\n  /**\n   * Add the geocoder to a container. The container can be either a `mapboxgl.Map`, an `HTMLElement` or a CSS selector string.\n   *\n   * If the container is a [`mapboxgl.Map`](https://docs.mapbox.com/mapbox-gl-js/api/map/), this function will behave identically to [`Map.addControl(geocoder)`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#addcontrol).\n   * If the container is an instance of [`HTMLElement`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement), then the geocoder will be appended as a child of that [`HTMLElement`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement).\n   * If the container is a [CSS selector string](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors), the geocoder will be appended to the element returned from the query.\n   *\n   * This function will throw an error if the container is none of the above.\n   * It will also throw an error if the referenced HTML element cannot be found in the `document.body`.\n   *\n   * For example, if the HTML body contains the element `<div id='geocoder-container'></div>`, the following script will append the geocoder to `#geocoder-container`:\n   *\n   * ```javascript\n   * var geocoder = new MapboxGeocoder({ accessToken: mapboxgl.accessToken });\n   * geocoder.addTo('#geocoder-container');\n   * ```\n   * @param {String|HTMLElement|mapboxgl.Map} container A reference to the container to which to add the geocoder\n   */\n  addTo: function (container) {\n    function addToExistingContainer(geocoder, container) {\n      if (!document.body.contains(container)) {\n        throw new Error(\"Element provided to #addTo() exists, but is not in the DOM\");\n      }\n\n      const el = geocoder.onAdd(); //returns the input elements, which are then added to the requested html container\n\n      container.appendChild(el);\n    } // if the container is a map, add the control like normal\n\n\n    if (container._controlContainer) {\n      //  it's a mapbox-gl map, add like normal\n      container.addControl(this);\n    } // if the container is an HTMLElement, then set the parent to be that element\n    else if (container instanceof HTMLElement) {\n      addToExistingContainer(this, container);\n    } // if the container is a string, treat it as a CSS query\n    else if (typeof container == 'string') {\n      const parent = document.querySelectorAll(container);\n\n      if (parent.length === 0) {\n        throw new Error(\"Element \", container, \"not found.\");\n      }\n\n      if (parent.length > 1) {\n        throw new Error(\"Geocoder can only be added to a single html element\");\n      }\n\n      addToExistingContainer(this, parent[0]);\n    } else {\n      throw new Error(\"Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element\");\n    }\n  },\n  onAdd: function (map) {\n    if (map && typeof map != 'string') {\n      this._map = map;\n    }\n\n    this.setLanguage();\n\n    if (!this.options.localGeocoderOnly) {\n      this.geocoderService = mbxGeocoder(MapboxClient({\n        accessToken: this.options.accessToken,\n        origin: this.options.origin\n      }));\n    }\n\n    if (this.options.localGeocoderOnly && !this.options.localGeocoder) {\n      throw new Error(\"A localGeocoder function must be specified to use localGeocoderOnly mode\");\n    }\n\n    this.eventManager = new MapboxEventManager(this.options);\n    this._onChange = this._onChange.bind(this);\n    this._onKeyDown = this._onKeyDown.bind(this);\n    this._onPaste = this._onPaste.bind(this);\n    this._onBlur = this._onBlur.bind(this);\n    this._showButton = this._showButton.bind(this);\n    this._hideButton = this._hideButton.bind(this);\n    this._onQueryResult = this._onQueryResult.bind(this);\n    this.clear = this.clear.bind(this);\n    this._updateProximity = this._updateProximity.bind(this);\n    this._collapse = this._collapse.bind(this);\n    this._unCollapse = this._unCollapse.bind(this);\n    this._clear = this._clear.bind(this);\n    this._clearOnBlur = this._clearOnBlur.bind(this);\n    var el = this.container = document.createElement('div');\n    el.className = 'mapboxgl-ctrl-geocoder mapboxgl-ctrl';\n    var searchIcon = this.createIcon('search', '<path d=\"M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z\"/>');\n    this._inputEl = document.createElement('input');\n    this._inputEl.type = 'text';\n    this._inputEl.className = 'mapboxgl-ctrl-geocoder--input';\n    this.setPlaceholder();\n\n    if (this.options.collapsed) {\n      this._collapse();\n\n      this.container.addEventListener('mouseenter', this._unCollapse);\n      this.container.addEventListener('mouseleave', this._collapse);\n\n      this._inputEl.addEventListener('focus', this._unCollapse);\n    }\n\n    if (this.options.collapsed || this.options.clearOnBlur) {\n      this._inputEl.addEventListener('blur', this._onBlur);\n    }\n\n    this._inputEl.addEventListener('keydown', debounce(this._onKeyDown, 200));\n\n    this._inputEl.addEventListener('paste', this._onPaste);\n\n    this._inputEl.addEventListener('change', this._onChange);\n\n    this.container.addEventListener('mouseenter', this._showButton);\n    this.container.addEventListener('mouseleave', this._hideButton);\n\n    this._inputEl.addEventListener('keyup', function (e) {\n      this.eventManager.keyevent(e, this);\n    }.bind(this));\n\n    var actions = document.createElement('div');\n    actions.classList.add('mapboxgl-ctrl-geocoder--pin-right');\n    this._clearEl = document.createElement('button');\n\n    this._clearEl.setAttribute('aria-label', 'Clear');\n\n    this._clearEl.addEventListener('click', this.clear);\n\n    this._clearEl.className = 'mapboxgl-ctrl-geocoder--button';\n    var buttonIcon = this.createIcon('close', '<path d=\"M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z\"/>');\n\n    this._clearEl.appendChild(buttonIcon);\n\n    this._loadingEl = this.createIcon('loading', '<path fill=\"#333\" d=\"M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z\"/><path opacity=\".1\" d=\"M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z\"/>');\n    actions.appendChild(this._clearEl);\n    actions.appendChild(this._loadingEl);\n    el.appendChild(searchIcon);\n    el.appendChild(this._inputEl);\n    el.appendChild(actions);\n    this._typeahead = new Typeahead(this._inputEl, [], {\n      filter: false,\n      minLength: this.options.minLength,\n      limit: this.options.limit\n    });\n    this.setRenderFunction(this.options.render);\n    this._typeahead.getItemValue = this.options.getItemValue;\n    this.mapMarker = null;\n    this._handleMarker = this._handleMarker.bind(this);\n\n    if (this._map) {\n      if (this.options.trackProximity) {\n        this._updateProximity();\n\n        this._map.on('moveend', this._updateProximity);\n      }\n\n      this._mapboxgl = this.options.mapboxgl;\n\n      if (!this._mapboxgl && this.options.marker) {\n        // eslint-disable-next-line no-console\n        console.error(\"No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl.\");\n        this.options.marker = false;\n      }\n    }\n\n    return el;\n  },\n  createIcon: function (name, path) {\n    var icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    icon.setAttribute('class', 'mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-' + name);\n    icon.setAttribute('viewBox', '0 0 18 18');\n    icon.setAttribute('xml:space', 'preserve');\n    icon.setAttribute('width', 18);\n    icon.setAttribute('height', 18); // IE does not have innerHTML for SVG nodes\n\n    if (!('innerHTML' in icon)) {\n      var SVGNodeContainer = document.createElement('div');\n      SVGNodeContainer.innerHTML = '<svg>' + path.valueOf().toString() + '</svg>';\n      var SVGNode = SVGNodeContainer.firstChild,\n          SVGPath = SVGNode.firstChild;\n      icon.appendChild(SVGPath);\n    } else {\n      icon.innerHTML = path;\n    }\n\n    return icon;\n  },\n  onRemove: function () {\n    this.container.parentNode.removeChild(this.container);\n\n    if (this.options.trackProximity && this._map) {\n      this._map.off('moveend', this._updateProximity);\n    }\n\n    this._removeMarker();\n\n    this._map = null;\n    return this;\n  },\n  _onPaste: function (e) {\n    var value = (e.clipboardData || window.clipboardData).getData('text');\n\n    if (value.length >= this.options.minLength) {\n      this._geocode(value);\n    }\n  },\n  _onKeyDown: function (e) {\n    var ESC_KEY_CODE = 27,\n        TAB_KEY_CODE = 9;\n\n    if (e.keyCode === ESC_KEY_CODE && this.options.clearAndBlurOnEsc) {\n      this._clear(e);\n\n      return this._inputEl.blur();\n    } // if target has shadowRoot, then get the actual active element inside the shadowRoot\n\n\n    var target = e.target && e.target.shadowRoot ? e.target.shadowRoot.activeElement : e.target;\n    var value = target ? target.value : '';\n\n    if (!value) {\n      this.fresh = true; // the user has removed all the text\n\n      if (e.keyCode !== TAB_KEY_CODE) this.clear(e);\n      return this._clearEl.style.display = 'none';\n    } // TAB, ESC, LEFT, RIGHT, ENTER, UP, DOWN\n\n\n    if (e.metaKey || [TAB_KEY_CODE, ESC_KEY_CODE, 37, 39, 13, 38, 40].indexOf(e.keyCode) !== -1) return;\n\n    if (target.value.length >= this.options.minLength) {\n      this._geocode(target.value);\n    }\n  },\n  _showButton: function () {\n    if (this._typeahead.selected) this._clearEl.style.display = 'block';\n  },\n  _hideButton: function () {\n    if (this._typeahead.selected) this._clearEl.style.display = 'none';\n  },\n  _onBlur: function (e) {\n    if (this.options.clearOnBlur) {\n      this._clearOnBlur(e);\n    }\n\n    if (this.options.collapsed) {\n      this._collapse();\n    }\n  },\n  _onChange: function () {\n    var selected = this._typeahead.selected;\n\n    if (selected && JSON.stringify(selected) !== this.lastSelected) {\n      this._clearEl.style.display = 'none';\n\n      if (this.options.flyTo) {\n        var flyOptions;\n\n        if (selected.properties && exceptions[selected.properties.short_code]) {\n          // Certain geocoder search results return (and therefore zoom to fit)\n          // an unexpectedly large bounding box: for example, both Russia and the\n          // USA span both sides of -180/180, or France includes the island of\n          // Reunion in the Indian Ocean. An incomplete list of these exceptions\n          // at ./exceptions.json provides \"reasonable\" bounding boxes as a\n          // short-term solution; this may be amended as necessary.\n          flyOptions = extend({}, this.options.flyTo);\n\n          if (this._map) {\n            this._map.fitBounds(exceptions[selected.properties.short_code].bbox, flyOptions);\n          }\n        } else if (selected.bbox) {\n          var bbox = selected.bbox;\n          flyOptions = extend({}, this.options.flyTo);\n\n          if (this._map) {\n            this._map.fitBounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]], flyOptions);\n          }\n        } else {\n          var defaultFlyOptions = {\n            zoom: this.options.zoom\n          };\n          flyOptions = extend({}, defaultFlyOptions, this.options.flyTo); //  ensure that center is not overriden by custom options\n\n          if (selected.center) {\n            flyOptions.center = selected.center;\n          } else if (selected.geometry && selected.geometry.type && selected.geometry.type === 'Point' && selected.geometry.coordinates) {\n            flyOptions.center = selected.geometry.coordinates;\n          }\n\n          if (this._map) {\n            this._map.flyTo(flyOptions);\n          }\n        }\n      }\n\n      if (this.options.marker && this._mapboxgl) {\n        this._handleMarker(selected);\n      } // After selecting a feature, re-focus the textarea and set\n      // cursor at start.\n\n\n      this._inputEl.focus();\n\n      this._inputEl.scrollLeft = 0;\n\n      this._inputEl.setSelectionRange(0, 0);\n\n      this.lastSelected = JSON.stringify(selected);\n\n      this._eventEmitter.emit('result', {\n        result: selected\n      });\n\n      this.eventManager.select(selected, this);\n    }\n  },\n  _requestType: function (options, search) {\n    var type;\n    const reverseGeocodeCoordRgx = /^[ ]*(-?\\d+\\.?\\d*)[, ]+(-?\\d+\\.?\\d*)[ ]*$/;\n\n    if (options.localGeocoderOnly) {\n      type = GEOCODE_REQUEST_TYPE.LOCAL;\n    } else if (options.reverseGeocode && reverseGeocodeCoordRgx.test(search)) {\n      type = GEOCODE_REQUEST_TYPE.REVERSE;\n    } else {\n      type = GEOCODE_REQUEST_TYPE.FORWARD;\n    }\n\n    return type;\n  },\n  _setupConfig: function (requestType, search) {\n    // Possible config properties to pass to client\n    const keys = ['bbox', 'limit', 'proximity', 'countries', 'types', 'language', 'reverseMode', 'mode'];\n    const spacesOrCommaRgx = /[\\s,]+/;\n    var self = this;\n    var config = keys.reduce(function (config, key) {\n      if (!self.options[key]) {\n        return config;\n      } // countries, types, and language need to be passed in as arrays to client\n      // https://github.com/mapbox/mapbox-sdk-js/blob/master/services/geocoding.js#L38-L47\n\n\n      ['countries', 'types', 'language'].indexOf(key) > -1 ? config[key] = self.options[key].split(spacesOrCommaRgx) : config[key] = self.options[key];\n      const isCoordKey = typeof self.options[key].longitude === 'number' && typeof self.options[key].latitude === 'number';\n\n      if (key === 'proximity' && isCoordKey) {\n        const lng = self.options[key].longitude;\n        const lat = self.options[key].latitude;\n        config[key] = [lng, lat];\n      }\n\n      return config;\n    }, {});\n\n    switch (requestType) {\n      case GEOCODE_REQUEST_TYPE.REVERSE:\n        {\n          var coords = search.split(spacesOrCommaRgx).map(function (c) {\n            return parseFloat(c, 10);\n          }).reverse(); // client only accepts one type for reverseGeocode, so\n          // use first config type if one, if not default to poi\n\n          config.types ? [config.types[0]] : [\"poi\"];\n          config = extend(config, {\n            query: coords,\n            limit: 1\n          }); // drop proximity which may have been set by trackProximity\n          // since it's not supported by the reverseGeocoder\n\n          if ('proximity' in config) {\n            delete config.proximity;\n          }\n        }\n        break;\n\n      case GEOCODE_REQUEST_TYPE.FORWARD:\n        {\n          // Ensure that any reverse geocoding looking request is cleaned up\n          // to be processed as only a forward geocoding request by the server.\n          const reverseGeocodeCoordRgx = /^[ ]*(-?\\d+\\.?\\d*)[, ]+(-?\\d+\\.?\\d*)*[ ]*$/;\n\n          if (reverseGeocodeCoordRgx.test(search)) {\n            search = search.replace(/,/g, ' ');\n          }\n\n          config = extend(config, {\n            query: search\n          });\n        }\n        break;\n    }\n\n    return config;\n  },\n  _geocode: function (searchInput) {\n    this.inputString = searchInput;\n    this._loadingEl.style.display = 'block';\n\n    this._eventEmitter.emit('loading', {\n      query: searchInput\n    });\n\n    const requestType = this._requestType(this.options, searchInput);\n\n    const config = this._setupConfig(requestType, searchInput);\n\n    var request;\n\n    switch (requestType) {\n      case GEOCODE_REQUEST_TYPE.LOCAL:\n        request = Promise.resolve();\n        break;\n\n      case GEOCODE_REQUEST_TYPE.FORWARD:\n        request = this.geocoderService.forwardGeocode(config).send();\n        break;\n\n      case GEOCODE_REQUEST_TYPE.REVERSE:\n        request = this.geocoderService.reverseGeocode(config).send();\n        break;\n    }\n\n    var localGeocoderRes = this.options.localGeocoder ? this.options.localGeocoder(searchInput) || [] : [];\n    var externalGeocoderRes = [];\n    var geocoderError = null;\n    request.catch(function (error) {\n      geocoderError = error;\n    }.bind(this)).then(function (response) {\n      this._loadingEl.style.display = 'none';\n      var res = {};\n\n      if (!response) {\n        res = {\n          type: 'FeatureCollection',\n          features: []\n        };\n      } else if (response.statusCode == '200') {\n        res = response.body;\n        res.request = response.request;\n        res.headers = response.headers;\n      }\n\n      res.config = config;\n\n      if (this.fresh) {\n        this.eventManager.start(this);\n        this.fresh = false;\n      } // supplement Mapbox Geocoding API results with locally populated results\n\n\n      res.features = res.features ? localGeocoderRes.concat(res.features) : localGeocoderRes;\n\n      if (this.options.externalGeocoder) {\n        externalGeocoderRes = this.options.externalGeocoder(searchInput, res.features) || []; // supplement Mapbox Geocoding API results with features returned by a promise\n\n        return externalGeocoderRes.then(function (features) {\n          res.features = res.features ? features.concat(res.features) : features;\n          return res;\n        }, function () {\n          // on error, display the original result\n          return res;\n        });\n      }\n\n      return res;\n    }.bind(this)).then(function (res) {\n      if (geocoderError) {\n        throw geocoderError;\n      } // apply results filter if provided\n\n\n      if (this.options.filter && res.features.length) {\n        res.features = res.features.filter(this.options.filter);\n      }\n\n      if (res.features.length) {\n        this._clearEl.style.display = 'block';\n\n        this._eventEmitter.emit('results', res);\n\n        this._typeahead.update(res.features);\n      } else {\n        this._clearEl.style.display = 'none';\n        this._typeahead.selected = null;\n\n        this._renderNoResults();\n\n        this._eventEmitter.emit('results', res);\n      }\n    }.bind(this)).catch(function (err) {\n      this._loadingEl.style.display = 'none'; // in the event of an error in the Mapbox Geocoding API still display results from the localGeocoder\n\n      if (localGeocoderRes.length && this.options.localGeocoder || externalGeocoderRes.length && this.options.externalGeocoder) {\n        this._clearEl.style.display = 'block';\n\n        this._typeahead.update(localGeocoderRes);\n      } else {\n        this._clearEl.style.display = 'none';\n        this._typeahead.selected = null;\n\n        this._renderError();\n      }\n\n      this._eventEmitter.emit('results', {\n        features: localGeocoderRes\n      });\n\n      this._eventEmitter.emit('error', {\n        error: err\n      });\n    }.bind(this));\n    return request;\n  },\n\n  /**\n   * Shared logic for clearing input\n   * @param {Event} [ev] the event that triggered the clear, if available\n   * @private\n   *\n   */\n  _clear: function (ev) {\n    if (ev) ev.preventDefault();\n    this._inputEl.value = '';\n    this._typeahead.selected = null;\n\n    this._typeahead.clear();\n\n    this._onChange();\n\n    this._clearEl.style.display = 'none';\n\n    this._removeMarker();\n\n    this.lastSelected = null;\n\n    this._eventEmitter.emit('clear');\n\n    this.fresh = true;\n  },\n\n  /**\n   * Clear and then focus the input.\n   * @param {Event} [ev] the event that triggered the clear, if available\n   *\n   */\n  clear: function (ev) {\n    this._clear(ev);\n\n    this._inputEl.focus();\n  },\n\n  /**\n   * Clear the input, without refocusing it. Used to implement clearOnBlur\n   * constructor option.\n   * @param {Event} [ev] the blur event\n   * @private\n   */\n  _clearOnBlur: function (ev) {\n    var ctx = this;\n    /*\n     * If relatedTarget is not found, assume user targeted the suggestions list.\n     * In that case, do not clear on blur. There are other edge cases where\n     * ev.relatedTarget could be null. Clicking on list always results in null\n     * relatedtarget because of upstream behavior in `suggestions`.\n     *\n     * The ideal solution would be to check if ev.relatedTarget is a child of\n     * the list. See issue #258 for details on why we can't do that yet.\n     */\n\n    if (ev.relatedTarget) {\n      ctx._clear(ev);\n    }\n  },\n  _onQueryResult: function (response) {\n    var results = response.body;\n    if (!results.features.length) return;\n    var result = results.features[0];\n    this._typeahead.selected = result;\n    this._inputEl.value = result.place_name;\n\n    this._onChange();\n  },\n  _updateProximity: function () {\n    // proximity is designed for local scale, if the user is looking at the whole world,\n    // it doesn't make sense to factor in the arbitrary centre of the map\n    if (!this._map) {\n      return;\n    }\n\n    if (this._map.getZoom() > 9) {\n      var center = this._map.getCenter().wrap();\n\n      this.setProximity({\n        longitude: center.lng,\n        latitude: center.lat\n      });\n    } else {\n      this.setProximity(null);\n    }\n  },\n  _collapse: function () {\n    // do not collapse if input is in focus\n    if (!this._inputEl.value && this._inputEl !== document.activeElement) this.container.classList.add('mapboxgl-ctrl-geocoder--collapsed');\n  },\n  _unCollapse: function () {\n    this.container.classList.remove('mapboxgl-ctrl-geocoder--collapsed');\n  },\n\n  /**\n   * Set & query the input\n   * @param {string} searchInput location name or other search input\n   * @returns {MapboxGeocoder} this\n   */\n  query: function (searchInput) {\n    this._geocode(searchInput).then(this._onQueryResult);\n\n    return this;\n  },\n  _renderError: function () {\n    var errorMessage = \"<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>\";\n\n    this._renderMessage(errorMessage);\n  },\n  _renderNoResults: function () {\n    var errorMessage = \"<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>\";\n\n    this._renderMessage(errorMessage);\n  },\n  _renderMessage: function (msg) {\n    this._typeahead.update([]);\n\n    this._typeahead.selected = null;\n\n    this._typeahead.clear();\n\n    this._typeahead.renderError(msg);\n  },\n\n  /**\n   * Get the text to use as the search bar placeholder\n   *\n   * If placeholder is provided in options, then use options.placeholder\n   * Otherwise, if language is provided in options, then use the localized string of the first language if available\n   * Otherwise use the default\n   *\n   * @returns {String} the value to use as the search bar placeholder\n   * @private\n   */\n  _getPlaceholderText: function () {\n    if (this.options.placeholder) return this.options.placeholder;\n\n    if (this.options.language) {\n      var firstLanguage = this.options.language.split(\",\")[0];\n      var language = subtag.language(firstLanguage);\n      var localizedValue = localization.placeholder[language];\n      if (localizedValue) return localizedValue;\n    }\n\n    return 'Search';\n  },\n\n  /**\n   * Set input\n   * @param {string} searchInput location name or other search input\n   * @returns {MapboxGeocoder} this\n   */\n  setInput: function (searchInput) {\n    // Set input value to passed value and clear everything else.\n    this._inputEl.value = searchInput;\n    this._typeahead.selected = null;\n\n    this._typeahead.clear();\n\n    if (searchInput.length >= this.options.minLength) {\n      this._geocode(searchInput);\n    }\n\n    return this;\n  },\n\n  /**\n   * Set proximity\n   * @param {Object} proximity The new `options.proximity` value. This is a geographical point given as an object with `latitude` and `longitude` properties.\n   * @returns {MapboxGeocoder} this\n   */\n  setProximity: function (proximity) {\n    this.options.proximity = proximity;\n    return this;\n  },\n\n  /**\n   * Get proximity\n   * @returns {Object} The geocoder proximity\n   */\n  getProximity: function () {\n    return this.options.proximity;\n  },\n\n  /**\n   * Set the render function used in the results dropdown\n   * @param {Function} fn The function to use as a render function. This function accepts a single [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) object as input and returns a string.\n   * @returns {MapboxGeocoder} this\n   */\n  setRenderFunction: function (fn) {\n    if (fn && typeof fn == \"function\") {\n      this._typeahead.render = fn;\n    }\n\n    return this;\n  },\n\n  /**\n   * Get the function used to render the results dropdown\n   *\n   * @returns {Function} the render function\n   */\n  getRenderFunction: function () {\n    return this._typeahead.render;\n  },\n\n  /**\n   * Get the language to use in UI elements and when making search requests\n   *\n   * Look first at the explicitly set options otherwise use the browser's language settings\n   * @param {String} language Specify the language to use for response text and query result weighting. Options are IETF language tags comprised of a mandatory ISO 639-1 language code and optionally one or more IETF subtags for country or script. More than one value can also be specified, separated by commas.\n   * @returns {MapboxGeocoder} this\n   */\n  setLanguage: function (language) {\n    var browserLocale = navigator.language || navigator.userLanguage || navigator.browserLanguage;\n    this.options.language = language || this.options.language || browserLocale;\n    return this;\n  },\n\n  /**\n   * Get the language to use in UI elements and when making search requests\n   * @returns {String} The language(s) used by the plugin, if any\n   */\n  getLanguage: function () {\n    return this.options.language;\n  },\n\n  /**\n   * Get the zoom level the map will move to when there is no bounding box on the selected result\n   * @returns {Number} the map zoom\n   */\n  getZoom: function () {\n    return this.options.zoom;\n  },\n\n  /**\n   * Set the zoom level\n   * @param {Number} zoom The zoom level that the map should animate to when a `bbox` isn't found in the response. If a `bbox` is found the map will fit to the `bbox`.\n   * @returns {MapboxGeocoder} this\n   */\n  setZoom: function (zoom) {\n    this.options.zoom = zoom;\n    return this;\n  },\n\n  /**\n   * Get the parameters used to fly to the selected response, if any\n   * @returns {Boolean|Object} The `flyTo` option\n   */\n  getFlyTo: function () {\n    return this.options.flyTo;\n  },\n\n  /**\n   * Set the flyTo options\n   * @param {Boolean|Object} flyTo If false, animating the map to a selected result is disabled. If true, animating the map will use the default animation parameters. If an object, it will be passed as `options` to the map [`flyTo`](https://docs.mapbox.com/mapbox-gl-js/api/#map#flyto) or [`fitBounds`](https://docs.mapbox.com/mapbox-gl-js/api/#map#fitbounds) method providing control over the animation of the transition.\n   */\n  setFlyTo: function (flyTo) {\n    this.options.flyTo = flyTo;\n    return this;\n  },\n\n  /**\n   * Get the value of the placeholder string\n   * @returns {String} The input element's placeholder value\n   */\n  getPlaceholder: function () {\n    return this.options.placeholder;\n  },\n\n  /**\n   * Set the value of the input element's placeholder\n   * @param {String} placeholder the text to use as the input element's placeholder\n   * @returns {MapboxGeocoder} this\n   */\n  setPlaceholder: function (placeholder) {\n    this.placeholder = placeholder ? placeholder : this._getPlaceholderText();\n    this._inputEl.placeholder = this.placeholder;\n\n    this._inputEl.setAttribute('aria-label', this.placeholder);\n\n    return this;\n  },\n\n  /**\n   * Get the bounding box used by the plugin\n   * @returns {Array<Number>} the bounding box, if any\n   */\n  getBbox: function () {\n    return this.options.bbox;\n  },\n\n  /**\n   * Set the bounding box to limit search results to\n   * @param {Array<Number>} bbox a bounding box given as an array in the format [minX, minY, maxX, maxY].\n   * @returns {MapboxGeocoder} this\n   */\n  setBbox: function (bbox) {\n    this.options.bbox = bbox;\n    return this;\n  },\n\n  /**\n   * Get a list of the countries to limit search results to\n   * @returns {String} a comma separated list of countries to limit to, if any\n   */\n  getCountries: function () {\n    return this.options.countries;\n  },\n\n  /**\n   * Set the countries to limit search results to\n   * @param {String} countries a comma separated list of countries to limit to\n   * @returns {MapboxGeocoder} this\n   */\n  setCountries: function (countries) {\n    this.options.countries = countries;\n    return this;\n  },\n\n  /**\n   * Get a list of the types to limit search results to\n   * @returns {String} a comma separated list of types to limit to\n   */\n  getTypes: function () {\n    return this.options.types;\n  },\n\n  /**\n   * Set the types to limit search results to\n   * @param {String} countries a comma separated list of types to limit to\n   * @returns {MapboxGeocoder} this\n   */\n  setTypes: function (types) {\n    this.options.types = types;\n    return this;\n  },\n\n  /**\n   * Get the minimum number of characters typed to trigger results used in the plugin\n   * @returns {Number} The minimum length in characters before a search is triggered\n   */\n  getMinLength: function () {\n    return this.options.minLength;\n  },\n\n  /**\n   * Set the minimum number of characters typed to trigger results used by the plugin\n   * @param {Number} minLength the minimum length in characters\n   * @returns {MapboxGeocoder} this\n   */\n  setMinLength: function (minLength) {\n    this.options.minLength = minLength;\n    if (this._typeahead) this._typeahead.options.minLength = minLength;\n    return this;\n  },\n\n  /**\n   * Get the limit value for the number of results to display used by the plugin\n   * @returns {Number} The limit value for the number of results to display used by the plugin\n   */\n  getLimit: function () {\n    return this.options.limit;\n  },\n\n  /**\n   * Set the limit value for the number of results to display used by the plugin\n   * @param {Number} limit the number of search results to return\n   * @returns {MapboxGeocoder}\n   */\n  setLimit: function (limit) {\n    this.options.limit = limit;\n    if (this._typeahead) this._typeahead.options.limit = limit;\n    return this;\n  },\n\n  /**\n   * Get the filter function used by the plugin\n   * @returns {Function} the filter function\n   */\n  getFilter: function () {\n    return this.options.filter;\n  },\n\n  /**\n   * Set the filter function used by the plugin.\n   * @param {Function} filter A function which accepts a Feature in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format to filter out results from the Geocoding API response before they are included in the suggestions list. Return `true` to keep the item, `false` otherwise.\n   * @returns {MapboxGeocoder} this\n   */\n  setFilter: function (filter) {\n    this.options.filter = filter;\n    return this;\n  },\n\n  /**\n   * Set the geocoding endpoint used by the plugin.\n   * @param {Function} origin A function which accepts an HTTPS URL to specify the endpoint to query results from.\n   * @returns {MapboxGeocoder} this\n   */\n  setOrigin: function (origin) {\n    this.options.origin = origin;\n    this.geocoderService = mbxGeocoder(MapboxClient({\n      accessToken: this.options.accessToken,\n      origin: this.options.origin\n    }));\n    return this;\n  },\n\n  /**\n   * Get the geocoding endpoint the plugin is currently set to\n   * @returns {Function} the endpoint URL\n   */\n  getOrigin: function () {\n    return this.options.origin;\n  },\n\n  /**\n   * Handle the placement of a result marking the selected result\n   * @private\n   * @param {Object} selected the selected geojson feature\n   * @returns {MapboxGeocoder} this\n   */\n  _handleMarker: function (selected) {\n    // clean up any old marker that might be present\n    if (!this._map) {\n      return;\n    }\n\n    this._removeMarker();\n\n    var defaultMarkerOptions = {\n      color: '#4668F2'\n    };\n    var markerOptions = extend({}, defaultMarkerOptions, this.options.marker);\n    this.mapMarker = new this._mapboxgl.Marker(markerOptions);\n\n    if (selected.center) {\n      this.mapMarker.setLngLat(selected.center).addTo(this._map);\n    } else if (selected.geometry && selected.geometry.type && selected.geometry.type === 'Point' && selected.geometry.coordinates) {\n      this.mapMarker.setLngLat(selected.geometry.coordinates).addTo(this._map);\n    }\n\n    return this;\n  },\n\n  /**\n   * Handle the removal of a result marker\n   * @private\n   */\n  _removeMarker: function () {\n    if (this.mapMarker) {\n      this.mapMarker.remove();\n      this.mapMarker = null;\n    }\n  },\n\n  /**\n   * Subscribe to events that happen within the plugin.\n   * @param {String} type name of event. Available events and the data passed into their respective event objects are:\n   *\n   * - __clear__ `Emitted when the input is cleared`\n   * - __loading__ `{ query } Emitted when the geocoder is looking up a query`\n   * - __results__ `{ results } Fired when the geocoder returns a response`\n   * - __result__ `{ result } Fired when input is set`\n   * - __error__ `{ error } Error as string`\n   * @param {Function} fn function that's called when the event is emitted.\n   * @returns {MapboxGeocoder} this;\n   */\n  on: function (type, fn) {\n    this._eventEmitter.on(type, fn);\n\n    return this;\n  },\n\n  /**\n   * Remove an event\n   * @returns {MapboxGeocoder} this\n   * @param {String} type Event name.\n   * @param {Function} fn Function that should unsubscribe to the event emitted.\n   */\n  off: function (type, fn) {\n    this._eventEmitter.removeListener(type, fn);\n\n    this.eventManager.remove();\n    return this;\n  }\n};\nmodule.exports = MapboxGeocoder;","map":{"version":3,"sources":["/home/tonilogar/Documentos/trabajos/servidorVirtual/www/html/repositoriesIcgc/geo-cart-viewer-react-node-mongodb/node_modules/@mapbox/mapbox-gl-geocoder/lib/index.js"],"names":["Typeahead","require","debounce","extend","EventEmitter","exceptions","MapboxClient","mbxGeocoder","MapboxEventManager","localization","subtag","GEOCODE_REQUEST_TYPE","FORWARD","LOCAL","REVERSE","MapboxGeocoder","options","_eventEmitter","inputString","fresh","lastSelected","prototype","zoom","flyTo","trackProximity","minLength","reverseGeocode","limit","origin","enableEventLogging","marker","mapboxgl","collapsed","clearAndBlurOnEsc","clearOnBlur","getItemValue","item","place_name","render","placeName","split","splice","length","join","addTo","container","addToExistingContainer","geocoder","document","body","contains","Error","el","onAdd","appendChild","_controlContainer","addControl","HTMLElement","parent","querySelectorAll","map","_map","setLanguage","localGeocoderOnly","geocoderService","accessToken","localGeocoder","eventManager","_onChange","bind","_onKeyDown","_onPaste","_onBlur","_showButton","_hideButton","_onQueryResult","clear","_updateProximity","_collapse","_unCollapse","_clear","_clearOnBlur","createElement","className","searchIcon","createIcon","_inputEl","type","setPlaceholder","addEventListener","e","keyevent","actions","classList","add","_clearEl","setAttribute","buttonIcon","_loadingEl","_typeahead","filter","setRenderFunction","mapMarker","_handleMarker","on","_mapboxgl","console","error","name","path","icon","createElementNS","SVGNodeContainer","innerHTML","valueOf","toString","SVGNode","firstChild","SVGPath","onRemove","parentNode","removeChild","off","_removeMarker","value","clipboardData","window","getData","_geocode","ESC_KEY_CODE","TAB_KEY_CODE","keyCode","blur","target","shadowRoot","activeElement","style","display","metaKey","indexOf","selected","JSON","stringify","flyOptions","properties","short_code","fitBounds","bbox","defaultFlyOptions","center","geometry","coordinates","focus","scrollLeft","setSelectionRange","emit","result","select","_requestType","search","reverseGeocodeCoordRgx","test","_setupConfig","requestType","keys","spacesOrCommaRgx","self","config","reduce","key","isCoordKey","longitude","latitude","lng","lat","coords","c","parseFloat","reverse","types","query","proximity","replace","searchInput","request","Promise","resolve","forwardGeocode","send","localGeocoderRes","externalGeocoderRes","geocoderError","catch","then","response","res","features","statusCode","headers","start","concat","externalGeocoder","update","_renderNoResults","err","_renderError","ev","preventDefault","ctx","relatedTarget","results","getZoom","getCenter","wrap","setProximity","remove","errorMessage","_renderMessage","msg","renderError","_getPlaceholderText","placeholder","language","firstLanguage","localizedValue","setInput","getProximity","fn","getRenderFunction","browserLocale","navigator","userLanguage","browserLanguage","getLanguage","setZoom","getFlyTo","setFlyTo","getPlaceholder","getBbox","setBbox","getCountries","countries","setCountries","getTypes","setTypes","getMinLength","setMinLength","getLimit","setLimit","getFilter","setFilter","setOrigin","getOrigin","defaultMarkerOptions","color","markerOptions","Marker","setLngLat","removeListener","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Typeahead = require('suggestions');\nvar debounce = require('lodash.debounce');\nvar extend = require('xtend');\nvar EventEmitter = require('events').EventEmitter;\nvar exceptions = require('./exceptions');\nvar MapboxClient = require('@mapbox/mapbox-sdk');\nvar mbxGeocoder = require('@mapbox/mapbox-sdk/services/geocoding');\nvar MapboxEventManager = require('./events');\nvar localization = require('./localization');\nvar subtag = require('subtag');\n\n\nconst GEOCODE_REQUEST_TYPE = {\n  FORWARD: 0,\n  LOCAL: 1,\n  REVERSE: 2,\n};\n\n/**\n * A geocoder component using the [Mapbox Geocoding API](https://docs.mapbox.com/api/search/#geocoding)\n * @class MapboxGeocoder\n * @param {Object} options\n * @param {String} options.accessToken Required.\n * @param {String} [options.origin=https://api.mapbox.com] Use to set a custom API origin.\n * @param {Object} [options.mapboxgl] A [mapbox-gl](https://github.com/mapbox/mapbox-gl-js) instance to use when creating [Markers](https://docs.mapbox.com/mapbox-gl-js/api/#marker). Required if `options.marker` is `true`.\n * @param {Number} [options.zoom=16] On geocoded result what zoom level should the map animate to when a `bbox` isn't found in the response. If a `bbox` is found the map will fit to the `bbox`.\n * @param {Boolean|Object} [options.flyTo=true] If `false`, animating the map to a selected result is disabled. If `true`, animating the map will use the default animation parameters. If an object, it will be passed as `options` to the map [`flyTo`](https://docs.mapbox.com/mapbox-gl-js/api/#map#flyto) or [`fitBounds`](https://docs.mapbox.com/mapbox-gl-js/api/#map#fitbounds) method providing control over the animation of the transition.\n * @param {String} [options.placeholder=Search] Override the default placeholder attribute value.\n * @param {Object} [options.proximity] a proximity argument: this is\n * a geographical point given as an object with `latitude` and `longitude`\n * properties. Search results closer to this point will be given\n * higher priority.\n * @param {Boolean} [options.trackProximity=true] If `true`, the geocoder proximity will automatically update based on the map view.\n * @param {Boolean} [options.collapsed=false] If `true`, the geocoder control will collapse until hovered or in focus.\n * @param {Boolean} [options.clearAndBlurOnEsc=false] If `true`, the geocoder control will clear it's contents and blur when user presses the escape key.\n * @param {Boolean} [options.clearOnBlur=false] If `true`, the geocoder control will clear its value when the input blurs.\n * @param {Array} [options.bbox] a bounding box argument: this is\n * a bounding box given as an array in the format `[minX, minY, maxX, maxY]`.\n * Search results will be limited to the bounding box.\n * @param {string} [options.countries] a comma separated list of country codes to\n * limit results to specified country or countries.\n * @param {string} [options.types] a comma seperated list of types that filter\n * results to match those specified. See https://docs.mapbox.com/api/search/#data-types\n * for available types.\n * If reverseGeocode is enabled and no type is specified, the type defaults to POIs. Otherwise, if you configure more than one type, the first type will be used.\n * @param {Number} [options.minLength=2] Minimum number of characters to enter before results are shown.\n * @param {Number} [options.limit=5] Maximum number of results to show.\n * @param {string} [options.language] Specify the language to use for response text and query result weighting. Options are IETF language tags comprised of a mandatory ISO 639-1 language code and optionally one or more IETF subtags for country or script. More than one value can also be specified, separated by commas. Defaults to the browser's language settings.\n * @param {Function} [options.filter] A function which accepts a Feature in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format to filter out results from the Geocoding API response before they are included in the suggestions list. Return `true` to keep the item, `false` otherwise.\n * @param {Function} [options.localGeocoder] A function accepting the query string which performs local geocoding to supplement results from the Mapbox Geocoding API. Expected to return an Array of GeoJSON Features in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format.\n * @param {Function} [options.externalGeocoder] A function accepting the query string and current features list which performs geocoding to supplement results from the Mapbox Geocoding API. Expected to return a Promise which resolves to an Array of GeoJSON Features in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format.\n * @param {distance|score} [options.reverseMode=distance] - Set the factors that are used to sort nearby results.\n * @param {boolean} [options.reverseGeocode=false] If `true`, enable reverse geocoding mode. In reverse geocoding, search input is expected to be coordinates in the form `lat, lon`, with suggestions being the reverse geocodes.\n * @param {Boolean} [options.enableEventLogging=true] Allow Mapbox to collect anonymous usage statistics from the plugin.\n * @param {Boolean|Object} [options.marker=true]  If `true`, a [Marker](https://docs.mapbox.com/mapbox-gl-js/api/#marker) will be added to the map at the location of the user-selected result using a default set of Marker options.  If the value is an object, the marker will be constructed using these options. If `false`, no marker will be added to the map. Requires that `options.mapboxgl` also be set.\n * @param {Function} [options.render] A function that specifies how the results should be rendered in the dropdown menu. This function should accepts a single [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) object as input and return a string. Any HTML in the returned string will be rendered.\n * @param {Function} [options.getItemValue] A function that specifies how the selected result should be rendered in the search bar. This function should accept a single [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) object as input and return a string. HTML tags in the output string will not be rendered. Defaults to `(item) => item.place_name`.\n * @param {String} [options.mode=mapbox.places] A string specifying the geocoding [endpoint](https://docs.mapbox.com/api/search/#endpoints) to query. Options are `mapbox.places` and `mapbox.places-permanent`. The `mapbox.places-permanent` mode requires an enterprise license for permanent geocodes.\n * @param {Boolean} [options.localGeocoderOnly=false] If `true`, indicates that the `localGeocoder` results should be the only ones returned to the user. If `false`, indicates that the `localGeocoder` results should be combined with those from the Mapbox API with the `localGeocoder` results ranked higher.\n * @example\n * var geocoder = new MapboxGeocoder({ accessToken: mapboxgl.accessToken });\n * map.addControl(geocoder);\n * @return {MapboxGeocoder} `this`\n *\n */\n\nfunction MapboxGeocoder(options) {\n  this._eventEmitter = new EventEmitter();\n  this.options = extend({}, this.options, options);\n  this.inputString = '';\n  this.fresh = true;\n  this.lastSelected = null;\n}\n\nMapboxGeocoder.prototype = {\n  options: {\n    zoom: 16,\n    flyTo: true,\n    trackProximity: true,\n    minLength: 2,\n    reverseGeocode: false,\n    limit: 5,\n    origin: 'https://api.mapbox.com',\n    enableEventLogging: true,\n    marker: true,\n    mapboxgl: null,\n    collapsed: false,\n    clearAndBlurOnEsc: false,\n    clearOnBlur: false,\n    getItemValue: function(item) {\n      return item.place_name\n    },\n    render: function(item) {\n      var placeName = item.place_name.split(',');\n      return '<div class=\"mapboxgl-ctrl-geocoder--suggestion\"><div class=\"mapboxgl-ctrl-geocoder--suggestion-title\">' + placeName[0]+ '</div><div class=\"mapboxgl-ctrl-geocoder--suggestion-address\">' + placeName.splice(1, placeName.length).join(',') + '</div></div>';\n    }\n  },\n\n  /**\n   * Add the geocoder to a container. The container can be either a `mapboxgl.Map`, an `HTMLElement` or a CSS selector string.\n   *\n   * If the container is a [`mapboxgl.Map`](https://docs.mapbox.com/mapbox-gl-js/api/map/), this function will behave identically to [`Map.addControl(geocoder)`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#addcontrol).\n   * If the container is an instance of [`HTMLElement`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement), then the geocoder will be appended as a child of that [`HTMLElement`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement).\n   * If the container is a [CSS selector string](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors), the geocoder will be appended to the element returned from the query.\n   *\n   * This function will throw an error if the container is none of the above.\n   * It will also throw an error if the referenced HTML element cannot be found in the `document.body`.\n   *\n   * For example, if the HTML body contains the element `<div id='geocoder-container'></div>`, the following script will append the geocoder to `#geocoder-container`:\n   *\n   * ```javascript\n   * var geocoder = new MapboxGeocoder({ accessToken: mapboxgl.accessToken });\n   * geocoder.addTo('#geocoder-container');\n   * ```\n   * @param {String|HTMLElement|mapboxgl.Map} container A reference to the container to which to add the geocoder\n   */\n  addTo: function(container){\n\n    function addToExistingContainer (geocoder, container) {\n      if (!document.body.contains(container)) {\n        throw new Error(\"Element provided to #addTo() exists, but is not in the DOM\")\n      }\n      const el = geocoder.onAdd(); //returns the input elements, which are then added to the requested html container\n      container.appendChild(el);\n    }\n\n    // if the container is a map, add the control like normal\n    if (container._controlContainer){\n      //  it's a mapbox-gl map, add like normal\n      container.addControl(this);\n    }\n    // if the container is an HTMLElement, then set the parent to be that element\n    else if (container instanceof HTMLElement) {\n      addToExistingContainer(this, container);\n    }\n    // if the container is a string, treat it as a CSS query\n    else if (typeof container == 'string'){\n      const parent = document.querySelectorAll(container);\n      if (parent.length === 0){\n        throw new Error(\"Element \", container, \"not found.\")\n      }\n\n      if (parent.length > 1){\n        throw new Error(\"Geocoder can only be added to a single html element\")\n      }\n\n      addToExistingContainer(this, parent[0]);\n    }else{\n      throw new Error(\"Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element\")\n    }\n  },\n\n  onAdd: function(map) {\n    if (map && typeof map != 'string'){\n      this._map = map;\n    }\n\n    this.setLanguage();\n\n    if (!this.options.localGeocoderOnly){\n      this.geocoderService = mbxGeocoder(\n        MapboxClient({\n          accessToken: this.options.accessToken,\n          origin: this.options.origin\n        })\n      );\n    }\n\n    if (this.options.localGeocoderOnly && !this.options.localGeocoder){\n      throw new Error(\"A localGeocoder function must be specified to use localGeocoderOnly mode\")\n    }\n\n    this.eventManager = new MapboxEventManager(this.options);\n\n    this._onChange = this._onChange.bind(this);\n    this._onKeyDown = this._onKeyDown.bind(this);\n    this._onPaste = this._onPaste.bind(this);\n    this._onBlur = this._onBlur.bind(this);\n    this._showButton = this._showButton.bind(this);\n    this._hideButton = this._hideButton.bind(this);\n    this._onQueryResult = this._onQueryResult.bind(this);\n    this.clear = this.clear.bind(this);\n    this._updateProximity = this._updateProximity.bind(this);\n    this._collapse = this._collapse.bind(this);\n    this._unCollapse = this._unCollapse.bind(this);\n    this._clear = this._clear.bind(this);\n    this._clearOnBlur = this._clearOnBlur.bind(this);\n\n    var el = (this.container = document.createElement('div'));\n    el.className = 'mapboxgl-ctrl-geocoder mapboxgl-ctrl';\n\n    var searchIcon = this.createIcon('search', '<path d=\"M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z\"/>')\n\n    this._inputEl = document.createElement('input');\n    this._inputEl.type = 'text';\n    this._inputEl.className = 'mapboxgl-ctrl-geocoder--input';\n\n    this.setPlaceholder();\n\n    if (this.options.collapsed) {\n      this._collapse();\n      this.container.addEventListener('mouseenter', this._unCollapse);\n      this.container.addEventListener('mouseleave', this._collapse);\n      this._inputEl.addEventListener('focus', this._unCollapse);\n    }\n\n    if (this.options.collapsed || this.options.clearOnBlur) {\n      this._inputEl.addEventListener('blur', this._onBlur);\n    }\n\n    this._inputEl.addEventListener('keydown', debounce(this._onKeyDown, 200));\n    this._inputEl.addEventListener('paste', this._onPaste);\n    this._inputEl.addEventListener('change', this._onChange);\n    this.container.addEventListener('mouseenter', this._showButton);\n    this.container.addEventListener('mouseleave', this._hideButton);\n    this._inputEl.addEventListener('keyup', function(e){\n      this.eventManager.keyevent(e, this);\n    }.bind(this));\n\n    var actions = document.createElement('div');\n    actions.classList.add('mapboxgl-ctrl-geocoder--pin-right');\n\n    this._clearEl = document.createElement('button');\n    this._clearEl.setAttribute('aria-label', 'Clear');\n    this._clearEl.addEventListener('click', this.clear);\n    this._clearEl.className = 'mapboxgl-ctrl-geocoder--button';\n\n    var buttonIcon = this.createIcon('close', '<path d=\"M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z\"/>')\n    this._clearEl.appendChild(buttonIcon);\n\n    this._loadingEl = this.createIcon('loading', '<path fill=\"#333\" d=\"M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z\"/><path opacity=\".1\" d=\"M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z\"/>');\n\n    actions.appendChild(this._clearEl);\n    actions.appendChild(this._loadingEl);\n\n    el.appendChild(searchIcon);\n    el.appendChild(this._inputEl);\n    el.appendChild(actions);\n\n    this._typeahead = new Typeahead(this._inputEl, [], {\n      filter: false,\n      minLength: this.options.minLength,\n      limit: this.options.limit\n    });\n\n    this.setRenderFunction(this.options.render);\n    this._typeahead.getItemValue = this.options.getItemValue;\n\n    this.mapMarker = null;\n    this._handleMarker = this._handleMarker.bind(this);\n    if (this._map){\n      if (this.options.trackProximity ) {\n        this._updateProximity();\n        this._map.on('moveend', this._updateProximity);\n      }\n      this._mapboxgl = this.options.mapboxgl;\n      if (!this._mapboxgl && this.options.marker) {\n        // eslint-disable-next-line no-console\n        console.error(\"No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl.\");\n        this.options.marker = false;\n      }\n    }\n    return el;\n  },\n\n  createIcon: function(name, path) {\n    var icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    icon.setAttribute('class', 'mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-' + name);\n    icon.setAttribute('viewBox', '0 0 18 18');\n    icon.setAttribute('xml:space','preserve');\n    icon.setAttribute('width', 18);\n    icon.setAttribute('height', 18);\n    // IE does not have innerHTML for SVG nodes\n    if (!('innerHTML' in icon)) {\n      var SVGNodeContainer = document.createElement('div');\n      SVGNodeContainer.innerHTML = '<svg>' + path.valueOf().toString() + '</svg>';\n      var SVGNode = SVGNodeContainer.firstChild,\n        SVGPath = SVGNode.firstChild;\n      icon.appendChild(SVGPath);\n    } else {\n      icon.innerHTML = path;\n    }\n    return icon;\n  },\n\n  onRemove: function() {\n    this.container.parentNode.removeChild(this.container);\n\n    if (this.options.trackProximity && this._map) {\n      this._map.off('moveend', this._updateProximity);\n    }\n\n    this._removeMarker();\n\n    this._map = null;\n\n    return this;\n  },\n\n  _onPaste: function(e){\n    var value = (e.clipboardData || window.clipboardData).getData('text');\n    if (value.length >= this.options.minLength) {\n      this._geocode(value);\n    }\n  },\n\n  _onKeyDown: function(e) {\n    var ESC_KEY_CODE = 27,\n      TAB_KEY_CODE = 9;\n\n    if (e.keyCode === ESC_KEY_CODE && this.options.clearAndBlurOnEsc) {\n      this._clear(e);\n      return this._inputEl.blur();\n    }\n\n    // if target has shadowRoot, then get the actual active element inside the shadowRoot\n    var target = e.target && e.target.shadowRoot\n      ? e.target.shadowRoot.activeElement\n      : e.target;\n    var value = target ? target.value : '';\n\n    if (!value) {\n      this.fresh = true;\n      // the user has removed all the text\n      if (e.keyCode !== TAB_KEY_CODE) this.clear(e);\n      return (this._clearEl.style.display = 'none');\n    }\n\n    // TAB, ESC, LEFT, RIGHT, ENTER, UP, DOWN\n    if ((e.metaKey || [TAB_KEY_CODE, ESC_KEY_CODE, 37, 39, 13, 38, 40].indexOf(e.keyCode) !== -1))\n      return;\n\n    if (target.value.length >= this.options.minLength) {\n      this._geocode(target.value);\n    }\n  },\n\n  _showButton: function() {\n    if (this._typeahead.selected) this._clearEl.style.display = 'block';\n  },\n\n  _hideButton: function() {\n    if (this._typeahead.selected) this._clearEl.style.display = 'none';\n  },\n\n  _onBlur: function(e) {\n    if (this.options.clearOnBlur) {\n      this._clearOnBlur(e);\n    }\n    if (this.options.collapsed) {\n      this._collapse();\n    }\n  },\n  _onChange: function() {\n    var selected = this._typeahead.selected;\n    if (selected  && JSON.stringify(selected) !== this.lastSelected) {\n      this._clearEl.style.display = 'none';\n      if (this.options.flyTo) {\n        var flyOptions;\n        if (selected.properties && exceptions[selected.properties.short_code]) {\n          // Certain geocoder search results return (and therefore zoom to fit)\n          // an unexpectedly large bounding box: for example, both Russia and the\n          // USA span both sides of -180/180, or France includes the island of\n          // Reunion in the Indian Ocean. An incomplete list of these exceptions\n          // at ./exceptions.json provides \"reasonable\" bounding boxes as a\n          // short-term solution; this may be amended as necessary.\n          flyOptions = extend({}, this.options.flyTo);\n          if (this._map){\n            this._map.fitBounds(exceptions[selected.properties.short_code].bbox, flyOptions);\n          }\n        } else if (selected.bbox) {\n          var bbox = selected.bbox;\n          flyOptions = extend({}, this.options.flyTo);\n          if (this._map){\n            this._map.fitBounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]], flyOptions);\n          }\n        } else {\n          var defaultFlyOptions = {\n            zoom: this.options.zoom\n          }\n          flyOptions = extend({}, defaultFlyOptions, this.options.flyTo);\n          //  ensure that center is not overriden by custom options\n          if (selected.center) {\n            flyOptions.center = selected.center;\n          } else if (selected.geometry && selected.geometry.type && selected.geometry.type === 'Point' && selected.geometry.coordinates) {\n            flyOptions.center = selected.geometry.coordinates;\n          }\n\n          if (this._map){\n            this._map.flyTo(flyOptions);\n          }\n        }\n      }\n      if (this.options.marker && this._mapboxgl){\n        this._handleMarker(selected);\n      }\n\n      // After selecting a feature, re-focus the textarea and set\n      // cursor at start.\n      this._inputEl.focus();\n      this._inputEl.scrollLeft = 0;\n      this._inputEl.setSelectionRange(0, 0);\n      this.lastSelected = JSON.stringify(selected);\n      this._eventEmitter.emit('result', { result: selected });\n      this.eventManager.select(selected, this);\n    }\n  },\n\n  _requestType: function(options, search) {\n    var type;\n    const reverseGeocodeCoordRgx = /^[ ]*(-?\\d+\\.?\\d*)[, ]+(-?\\d+\\.?\\d*)[ ]*$/;\n    if (options.localGeocoderOnly) {\n      type = GEOCODE_REQUEST_TYPE.LOCAL;\n    } else if (options.reverseGeocode && reverseGeocodeCoordRgx.test(search)) {\n      type = GEOCODE_REQUEST_TYPE.REVERSE;\n    } else {\n      type = GEOCODE_REQUEST_TYPE.FORWARD;\n    }\n    return type;\n  },\n\n  _setupConfig: function(requestType, search) {\n    // Possible config properties to pass to client\n    const keys = [\n      'bbox',\n      'limit',\n      'proximity',\n      'countries',\n      'types',\n      'language',\n      'reverseMode',\n      'mode'\n    ];\n    const spacesOrCommaRgx = /[\\s,]+/;\n\n    var self = this;\n    var config = keys.reduce(function(config, key) {\n      if (!self.options[key]) {\n        return config;\n      }\n\n      // countries, types, and language need to be passed in as arrays to client\n      // https://github.com/mapbox/mapbox-sdk-js/blob/master/services/geocoding.js#L38-L47\n      ['countries', 'types', 'language'].indexOf(key) > -1\n        ? (config[key] = self.options[key].split(spacesOrCommaRgx))\n        : (config[key] = self.options[key]);\n\n      const isCoordKey =\n        typeof self.options[key].longitude === 'number' &&\n        typeof self.options[key].latitude  === 'number';\n\n      if (key === 'proximity' && isCoordKey) {\n        const lng = self.options[key].longitude;\n        const lat = self.options[key].latitude;\n\n        config[key] = [lng, lat];\n      }\n\n      return config;\n    }, {});\n\n    switch (requestType) {\n    case GEOCODE_REQUEST_TYPE.REVERSE: {\n      var coords = search.split(spacesOrCommaRgx).map(function(c) {\n        return parseFloat(c, 10);\n      }).reverse();\n\n      // client only accepts one type for reverseGeocode, so\n      // use first config type if one, if not default to poi\n      config.types ? [config.types[0]] : [\"poi\"];\n      config = extend(config, { query: coords, limit: 1 });\n\n      // drop proximity which may have been set by trackProximity\n      // since it's not supported by the reverseGeocoder\n      if ('proximity' in config) {\n        delete config.proximity;\n      }\n    } break;\n    case GEOCODE_REQUEST_TYPE.FORWARD: {\n      // Ensure that any reverse geocoding looking request is cleaned up\n      // to be processed as only a forward geocoding request by the server.\n      const reverseGeocodeCoordRgx = /^[ ]*(-?\\d+\\.?\\d*)[, ]+(-?\\d+\\.?\\d*)*[ ]*$/;\n      if (reverseGeocodeCoordRgx.test(search)) {\n        search = search.replace(/,/g, ' ');\n      }\n      config = extend(config, { query: search });\n    } break;\n    }\n\n    return config;\n  },\n\n  _geocode: function(searchInput) {\n    this.inputString = searchInput;\n    this._loadingEl.style.display = 'block';\n    this._eventEmitter.emit('loading', { query: searchInput });\n\n    const requestType = this._requestType(this.options, searchInput);\n    const config = this._setupConfig(requestType, searchInput);\n\n    var request;\n    switch (requestType) {\n    case GEOCODE_REQUEST_TYPE.LOCAL:\n      request = Promise.resolve();\n      break;\n    case GEOCODE_REQUEST_TYPE.FORWARD:\n      request = this.geocoderService.forwardGeocode(config).send();\n      break;\n    case GEOCODE_REQUEST_TYPE.REVERSE:\n      request = this.geocoderService.reverseGeocode(config).send();\n      break;\n    }\n\n    var localGeocoderRes = this.options.localGeocoder ? this.options.localGeocoder(searchInput) || [] : [];\n    var externalGeocoderRes = [];\n\n    var geocoderError = null;\n    request.catch(function(error) {\n      geocoderError = error;\n    }.bind(this))\n      .then(\n        function(response) {\n          this._loadingEl.style.display = 'none';\n\n          var res = {};\n\n          if (!response){\n            res = {\n              type: 'FeatureCollection',\n              features: []\n            }\n          } else if (response.statusCode == '200') {\n            res = response.body;\n            res.request = response.request\n            res.headers = response.headers\n          }\n\n          res.config = config;\n\n          if (this.fresh){\n            this.eventManager.start(this);\n            this.fresh = false;\n          }\n\n          // supplement Mapbox Geocoding API results with locally populated results\n          res.features = res.features\n            ? localGeocoderRes.concat(res.features)\n            : localGeocoderRes;\n\n          if (this.options.externalGeocoder) {\n\n            externalGeocoderRes = this.options.externalGeocoder(searchInput, res.features) || [];\n            // supplement Mapbox Geocoding API results with features returned by a promise\n            return externalGeocoderRes.then(function(features) {\n              res.features = res.features ? features.concat(res.features) : features;\n              return res;\n            }, function(){\n              // on error, display the original result\n              return res;\n            });\n          }\n          return res;\n\n        }.bind(this)).then(\n        function(res) {\n          if (geocoderError) {\n            throw geocoderError;\n          }\n\n          // apply results filter if provided\n          if (this.options.filter && res.features.length) {\n            res.features = res.features.filter(this.options.filter);\n          }\n\n          if (res.features.length) {\n            this._clearEl.style.display = 'block';\n            this._eventEmitter.emit('results', res);\n            this._typeahead.update(res.features);\n          } else {\n            this._clearEl.style.display = 'none';\n            this._typeahead.selected = null;\n            this._renderNoResults();\n            this._eventEmitter.emit('results', res);\n          }\n\n        }.bind(this)\n      ).catch(\n        function(err) {\n          this._loadingEl.style.display = 'none';\n\n          // in the event of an error in the Mapbox Geocoding API still display results from the localGeocoder\n          if ((localGeocoderRes.length && this.options.localGeocoder) || (externalGeocoderRes.length && this.options.externalGeocoder) ) {\n            this._clearEl.style.display = 'block';\n            this._typeahead.update(localGeocoderRes);\n          } else {\n            this._clearEl.style.display = 'none';\n            this._typeahead.selected = null;\n            this._renderError();\n          }\n\n          this._eventEmitter.emit('results', { features: localGeocoderRes });\n          this._eventEmitter.emit('error', { error: err });\n        }.bind(this)\n      );\n\n    return request;\n  },\n\n  /**\n   * Shared logic for clearing input\n   * @param {Event} [ev] the event that triggered the clear, if available\n   * @private\n   *\n   */\n  _clear: function(ev) {\n    if (ev) ev.preventDefault();\n    this._inputEl.value = '';\n    this._typeahead.selected = null;\n    this._typeahead.clear();\n    this._onChange();\n    this._clearEl.style.display = 'none';\n    this._removeMarker();\n    this.lastSelected = null;\n    this._eventEmitter.emit('clear');\n    this.fresh = true;\n  },\n\n  /**\n   * Clear and then focus the input.\n   * @param {Event} [ev] the event that triggered the clear, if available\n   *\n   */\n  clear: function(ev) {\n    this._clear(ev);\n    this._inputEl.focus();\n  },\n\n\n  /**\n   * Clear the input, without refocusing it. Used to implement clearOnBlur\n   * constructor option.\n   * @param {Event} [ev] the blur event\n   * @private\n   */\n  _clearOnBlur: function(ev) {\n    var ctx = this;\n\n    /*\n     * If relatedTarget is not found, assume user targeted the suggestions list.\n     * In that case, do not clear on blur. There are other edge cases where\n     * ev.relatedTarget could be null. Clicking on list always results in null\n     * relatedtarget because of upstream behavior in `suggestions`.\n     *\n     * The ideal solution would be to check if ev.relatedTarget is a child of\n     * the list. See issue #258 for details on why we can't do that yet.\n     */\n    if (ev.relatedTarget) {\n      ctx._clear(ev);\n    }\n  },\n\n  _onQueryResult: function(response) {\n    var results = response.body;\n    if (!results.features.length) return;\n    var result = results.features[0];\n    this._typeahead.selected = result;\n    this._inputEl.value = result.place_name;\n    this._onChange();\n  },\n\n  _updateProximity: function() {\n    // proximity is designed for local scale, if the user is looking at the whole world,\n    // it doesn't make sense to factor in the arbitrary centre of the map\n    if (!this._map){\n      return;\n    }\n    if (this._map.getZoom() > 9) {\n      var center = this._map.getCenter().wrap();\n      this.setProximity({ longitude: center.lng, latitude: center.lat });\n    } else {\n      this.setProximity(null);\n    }\n  },\n\n  _collapse: function() {\n    // do not collapse if input is in focus\n    if (!this._inputEl.value && this._inputEl !== document.activeElement) this.container.classList.add('mapboxgl-ctrl-geocoder--collapsed');\n  },\n\n  _unCollapse: function() {\n    this.container.classList.remove('mapboxgl-ctrl-geocoder--collapsed');\n  },\n\n  /**\n   * Set & query the input\n   * @param {string} searchInput location name or other search input\n   * @returns {MapboxGeocoder} this\n   */\n  query: function(searchInput) {\n    this._geocode(searchInput).then(this._onQueryResult);\n    return this;\n  },\n\n  _renderError: function(){\n    var errorMessage = \"<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>\"\n    this._renderMessage(errorMessage);\n  },\n\n  _renderNoResults: function(){\n    var errorMessage = \"<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>\";\n    this._renderMessage(errorMessage);\n  },\n\n  _renderMessage: function(msg){\n    this._typeahead.update([]);\n    this._typeahead.selected = null;\n    this._typeahead.clear();\n    this._typeahead.renderError(msg);\n  },\n\n  /**\n   * Get the text to use as the search bar placeholder\n   *\n   * If placeholder is provided in options, then use options.placeholder\n   * Otherwise, if language is provided in options, then use the localized string of the first language if available\n   * Otherwise use the default\n   *\n   * @returns {String} the value to use as the search bar placeholder\n   * @private\n   */\n  _getPlaceholderText: function(){\n    if (this.options.placeholder) return this.options.placeholder;\n    if (this.options.language){\n      var firstLanguage = this.options.language.split(\",\")[0];\n      var language = subtag.language(firstLanguage);\n      var localizedValue = localization.placeholder[language];\n      if (localizedValue)  return localizedValue;\n    }\n    return 'Search';\n  },\n\n  /**\n   * Set input\n   * @param {string} searchInput location name or other search input\n   * @returns {MapboxGeocoder} this\n   */\n  setInput: function(searchInput) {\n    // Set input value to passed value and clear everything else.\n    this._inputEl.value = searchInput;\n    this._typeahead.selected = null;\n    this._typeahead.clear();\n    if (searchInput.length >= this.options.minLength) {\n      this._geocode(searchInput);\n    }\n    return this;\n  },\n\n  /**\n   * Set proximity\n   * @param {Object} proximity The new `options.proximity` value. This is a geographical point given as an object with `latitude` and `longitude` properties.\n   * @returns {MapboxGeocoder} this\n   */\n  setProximity: function(proximity) {\n    this.options.proximity = proximity;\n    return this;\n  },\n\n  /**\n   * Get proximity\n   * @returns {Object} The geocoder proximity\n   */\n  getProximity: function() {\n    return this.options.proximity;\n  },\n\n  /**\n   * Set the render function used in the results dropdown\n   * @param {Function} fn The function to use as a render function. This function accepts a single [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) object as input and returns a string.\n   * @returns {MapboxGeocoder} this\n   */\n  setRenderFunction: function(fn){\n    if (fn && typeof(fn) == \"function\"){\n      this._typeahead.render = fn;\n    }\n    return this;\n  },\n\n  /**\n   * Get the function used to render the results dropdown\n   *\n   * @returns {Function} the render function\n   */\n  getRenderFunction: function(){\n    return this._typeahead.render;\n  },\n\n  /**\n   * Get the language to use in UI elements and when making search requests\n   *\n   * Look first at the explicitly set options otherwise use the browser's language settings\n   * @param {String} language Specify the language to use for response text and query result weighting. Options are IETF language tags comprised of a mandatory ISO 639-1 language code and optionally one or more IETF subtags for country or script. More than one value can also be specified, separated by commas.\n   * @returns {MapboxGeocoder} this\n   */\n  setLanguage: function(language){\n    var browserLocale = navigator.language || navigator.userLanguage || navigator.browserLanguage;\n    this.options.language = language || this.options.language || browserLocale;\n    return this;\n  },\n\n  /**\n   * Get the language to use in UI elements and when making search requests\n   * @returns {String} The language(s) used by the plugin, if any\n   */\n  getLanguage: function(){\n    return this.options.language;\n  },\n\n  /**\n   * Get the zoom level the map will move to when there is no bounding box on the selected result\n   * @returns {Number} the map zoom\n   */\n  getZoom: function(){\n    return this.options.zoom;\n  },\n\n  /**\n   * Set the zoom level\n   * @param {Number} zoom The zoom level that the map should animate to when a `bbox` isn't found in the response. If a `bbox` is found the map will fit to the `bbox`.\n   * @returns {MapboxGeocoder} this\n   */\n  setZoom: function(zoom){\n    this.options.zoom = zoom;\n    return this;\n  },\n\n  /**\n   * Get the parameters used to fly to the selected response, if any\n   * @returns {Boolean|Object} The `flyTo` option\n   */\n  getFlyTo: function(){\n    return this.options.flyTo;\n  },\n\n  /**\n   * Set the flyTo options\n   * @param {Boolean|Object} flyTo If false, animating the map to a selected result is disabled. If true, animating the map will use the default animation parameters. If an object, it will be passed as `options` to the map [`flyTo`](https://docs.mapbox.com/mapbox-gl-js/api/#map#flyto) or [`fitBounds`](https://docs.mapbox.com/mapbox-gl-js/api/#map#fitbounds) method providing control over the animation of the transition.\n   */\n  setFlyTo: function(flyTo){\n    this.options.flyTo = flyTo;\n    return this;\n  },\n\n  /**\n   * Get the value of the placeholder string\n   * @returns {String} The input element's placeholder value\n   */\n  getPlaceholder: function(){\n    return this.options.placeholder;\n  },\n\n  /**\n   * Set the value of the input element's placeholder\n   * @param {String} placeholder the text to use as the input element's placeholder\n   * @returns {MapboxGeocoder} this\n   */\n  setPlaceholder: function(placeholder){\n    this.placeholder = (placeholder) ? placeholder : this._getPlaceholderText();\n    this._inputEl.placeholder = this.placeholder;\n    this._inputEl.setAttribute('aria-label', this.placeholder);\n    return this\n  },\n\n  /**\n   * Get the bounding box used by the plugin\n   * @returns {Array<Number>} the bounding box, if any\n   */\n  getBbox: function(){\n    return this.options.bbox;\n  },\n\n  /**\n   * Set the bounding box to limit search results to\n   * @param {Array<Number>} bbox a bounding box given as an array in the format [minX, minY, maxX, maxY].\n   * @returns {MapboxGeocoder} this\n   */\n  setBbox: function(bbox){\n    this.options.bbox = bbox;\n    return this;\n  },\n\n  /**\n   * Get a list of the countries to limit search results to\n   * @returns {String} a comma separated list of countries to limit to, if any\n   */\n  getCountries: function(){\n    return this.options.countries;\n  },\n\n  /**\n   * Set the countries to limit search results to\n   * @param {String} countries a comma separated list of countries to limit to\n   * @returns {MapboxGeocoder} this\n   */\n  setCountries: function(countries){\n    this.options.countries = countries;\n    return this;\n  },\n\n  /**\n   * Get a list of the types to limit search results to\n   * @returns {String} a comma separated list of types to limit to\n   */\n  getTypes: function(){\n    return this.options.types;\n  },\n\n  /**\n   * Set the types to limit search results to\n   * @param {String} countries a comma separated list of types to limit to\n   * @returns {MapboxGeocoder} this\n   */\n  setTypes: function(types){\n    this.options.types = types;\n    return this;\n  },\n\n  /**\n   * Get the minimum number of characters typed to trigger results used in the plugin\n   * @returns {Number} The minimum length in characters before a search is triggered\n   */\n  getMinLength: function(){\n    return this.options.minLength;\n  },\n\n  /**\n   * Set the minimum number of characters typed to trigger results used by the plugin\n   * @param {Number} minLength the minimum length in characters\n   * @returns {MapboxGeocoder} this\n   */\n  setMinLength: function(minLength){\n    this.options.minLength = minLength;\n    if (this._typeahead)  this._typeahead.options.minLength = minLength;\n    return this;\n  },\n\n  /**\n   * Get the limit value for the number of results to display used by the plugin\n   * @returns {Number} The limit value for the number of results to display used by the plugin\n   */\n  getLimit: function(){\n    return this.options.limit;\n  },\n\n  /**\n   * Set the limit value for the number of results to display used by the plugin\n   * @param {Number} limit the number of search results to return\n   * @returns {MapboxGeocoder}\n   */\n  setLimit: function(limit){\n    this.options.limit = limit;\n    if (this._typeahead) this._typeahead.options.limit = limit;\n    return this;\n  },\n\n  /**\n   * Get the filter function used by the plugin\n   * @returns {Function} the filter function\n   */\n  getFilter: function(){\n    return this.options.filter;\n  },\n\n  /**\n   * Set the filter function used by the plugin.\n   * @param {Function} filter A function which accepts a Feature in the [Carmen GeoJSON](https://github.com/mapbox/carmen/blob/master/carmen-geojson.md) format to filter out results from the Geocoding API response before they are included in the suggestions list. Return `true` to keep the item, `false` otherwise.\n   * @returns {MapboxGeocoder} this\n   */\n  setFilter: function(filter){\n    this.options.filter = filter;\n    return this;\n  },\n\n  /**\n   * Set the geocoding endpoint used by the plugin.\n   * @param {Function} origin A function which accepts an HTTPS URL to specify the endpoint to query results from.\n   * @returns {MapboxGeocoder} this\n   */\n  setOrigin: function(origin){\n    this.options.origin = origin;\n    this.geocoderService = mbxGeocoder(\n      MapboxClient({\n        accessToken: this.options.accessToken,\n        origin: this.options.origin\n      })\n    );\n    return this;\n  },\n\n  /**\n   * Get the geocoding endpoint the plugin is currently set to\n   * @returns {Function} the endpoint URL\n   */\n  getOrigin: function(){\n    return this.options.origin;\n  },\n\n  /**\n   * Handle the placement of a result marking the selected result\n   * @private\n   * @param {Object} selected the selected geojson feature\n   * @returns {MapboxGeocoder} this\n   */\n  _handleMarker: function(selected){\n    // clean up any old marker that might be present\n    if (!this._map){\n      return;\n    }\n    this._removeMarker();\n    var defaultMarkerOptions = {\n      color: '#4668F2'\n    }\n    var markerOptions = extend({}, defaultMarkerOptions, this.options.marker)\n    this.mapMarker = new this._mapboxgl.Marker(markerOptions);\n    if (selected.center) {\n      this.mapMarker\n        .setLngLat(selected.center)\n        .addTo(this._map);\n    } else if (selected.geometry && selected.geometry.type && selected.geometry.type === 'Point' && selected.geometry.coordinates) {\n      this.mapMarker\n        .setLngLat(selected.geometry.coordinates)\n        .addTo(this._map);\n    }\n    return this;\n  },\n\n  /**\n   * Handle the removal of a result marker\n   * @private\n   */\n  _removeMarker: function(){\n    if (this.mapMarker){\n      this.mapMarker.remove();\n      this.mapMarker = null;\n    }\n  },\n\n  /**\n   * Subscribe to events that happen within the plugin.\n   * @param {String} type name of event. Available events and the data passed into their respective event objects are:\n   *\n   * - __clear__ `Emitted when the input is cleared`\n   * - __loading__ `{ query } Emitted when the geocoder is looking up a query`\n   * - __results__ `{ results } Fired when the geocoder returns a response`\n   * - __result__ `{ result } Fired when input is set`\n   * - __error__ `{ error } Error as string`\n   * @param {Function} fn function that's called when the event is emitted.\n   * @returns {MapboxGeocoder} this;\n   */\n  on: function(type, fn) {\n    this._eventEmitter.on(type, fn);\n    return this;\n  },\n\n  /**\n   * Remove an event\n   * @returns {MapboxGeocoder} this\n   * @param {String} type Event name.\n   * @param {Function} fn Function that should unsubscribe to the event emitted.\n   */\n  off: function(type, fn) {\n    this._eventEmitter.removeListener(type, fn);\n    this.eventManager.remove();\n    return this;\n  }\n};\n\nmodule.exports = MapboxGeocoder;\n"]},"metadata":{},"sourceType":"script"}